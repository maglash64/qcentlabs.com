<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hacking a Synaptics touchpad. | qcentlabs</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-PWDYJX7Y6B"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PWDYJX7Y6B")</script><meta name=keywords content><meta name=description content="The Backstory: I&rsquo;ve had a few laptops over the years, and one of the first things I do whenever I&rsquo;ve got a new piece of hardware is open it up.
Well, I live in India, and the environment here is quite dusty, so this act of opening and cleaning happens quite often.
Unfortunately, if you own a laptop with a plastic body, this becomes quite an issue, as plastic body laptops have knurled nuts pushed into the body, the plastic housings of these nuts tend to break over time if you regularly screw and unscrew."><meta name=author content="magalsh64"><link rel=canonical href=http://qcentlabs.com/posts/synaptics_hack/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://qcentlabs.com/logo.png><link rel=icon type=image/png sizes=16x16 href=http://qcentlabs.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://qcentlabs.com/favicon-32x32.png><link rel=apple-touch-icon href=http://qcentlabs.com/logo.png><link rel=mask-icon href=http://qcentlabs.com/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.112.3"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Hacking a Synaptics touchpad."><meta property="og:description" content="The Backstory: I&rsquo;ve had a few laptops over the years, and one of the first things I do whenever I&rsquo;ve got a new piece of hardware is open it up.
Well, I live in India, and the environment here is quite dusty, so this act of opening and cleaning happens quite often.
Unfortunately, if you own a laptop with a plastic body, this becomes quite an issue, as plastic body laptops have knurled nuts pushed into the body, the plastic housings of these nuts tend to break over time if you regularly screw and unscrew."><meta property="og:type" content="article"><meta property="og:url" content="http://qcentlabs.com/posts/synaptics_hack/"><meta property="og:image" content="http://qcentlabs.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-19T01:09:32+05:30"><meta property="article:modified_time" content="2022-12-19T01:09:32+05:30"><meta property="og:site_name" content="qcentlabs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://qcentlabs.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Hacking a Synaptics touchpad."><meta name=twitter:description content="The Backstory: I&rsquo;ve had a few laptops over the years, and one of the first things I do whenever I&rsquo;ve got a new piece of hardware is open it up.
Well, I live in India, and the environment here is quite dusty, so this act of opening and cleaning happens quite often.
Unfortunately, if you own a laptop with a plastic body, this becomes quite an issue, as plastic body laptops have knurled nuts pushed into the body, the plastic housings of these nuts tend to break over time if you regularly screw and unscrew."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://qcentlabs.com/posts/"},{"@type":"ListItem","position":2,"name":"Hacking a Synaptics touchpad.","item":"http://qcentlabs.com/posts/synaptics_hack/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hacking a Synaptics touchpad.","name":"Hacking a Synaptics touchpad.","description":"The Backstory: I\u0026rsquo;ve had a few laptops over the years, and one of the first things I do whenever I\u0026rsquo;ve got a new piece of hardware is open it up.\nWell, I live in India, and the environment here is quite dusty, so this act of opening and cleaning happens quite often.\nUnfortunately, if you own a laptop with a plastic body, this becomes quite an issue, as plastic body laptops have knurled nuts pushed into the body, the plastic housings of these nuts tend to break over time if you regularly screw and unscrew.","keywords":[],"articleBody":"The Backstory: I’ve had a few laptops over the years, and one of the first things I do whenever I’ve got a new piece of hardware is open it up.\nWell, I live in India, and the environment here is quite dusty, so this act of opening and cleaning happens quite often.\nUnfortunately, if you own a laptop with a plastic body, this becomes quite an issue, as plastic body laptops have knurled nuts pushed into the body, the plastic housings of these nuts tend to break over time if you regularly screw and unscrew. them.\nThis is especially a problem with the screws holding the LCD hinge to the main body, as these tend to break first, I’ve had at least 2 laptops that have broken this way.\nSo, coming back to the main title of this post, I had an old HP laptop lying around that had a broken hinge nut collecting dust, so I thought, Why not make something useful out of it?\n^^ My actual HP laptop :D ^^\nSo the plan was to use the motherboard as an external PC, encased in a acrylic case with all the RGB shenanigans. What was left were the keyboard, touchpad, and display.\nThe keyboard was the part of the main body that broke with the hinge, so that’s a goner.\nThe displays eDP cable pads rusted and broke after being exposed to the bare environment for years.\nBut somehow, the touchpad was fine and dandy.\nThe Saviour of Touchpads So, the time came to reverse engineer the touchpad and hopefully use it in some other useful projects in the future.\nThere are many ways to approach the problem of reverse engineering hardware.\nIn our case, we have complete access to the system that we are trying to reverse engineer, which makes our job easy.\nWe can observe the system from 2 sides:\nThe Software The Hardware From the software side, the laptops run Linux, which in itself helps us a lot, We can look into the kernel logs to see how it enumerates all the hardware.\nLet’s look into the kernel logs via dmesg and see if something comes up related to our touchpad.\nVoila! We can see the psmouse kernel module enumerating a synaptics touchpad, and we can also see the module logs list the max and min. values that the touchpad can output, and a string of possible touchpad IDs that match the one we have.\nThe beauty of Linux is that almost all of it is open source, including the device drivers, which are a huge chunk of the kernel source.\nSo we can just look into the source of the corresponding kernel module that enumerated our hardware to see how it works.\n[synaptics.c] (https://github.com/torvalds/linux/blob/master/drivers/input/mouse/synaptics.c)\nLooking at the sources, we can see how the module handles the device initialization, queries the hardware, identifies the capabilities of the device, setting its mode and then receiving packets and sending them forward into the input subsystem.\nWe also get to see that the module uses the psmouse module sources to actually send and receive packets, so we now know for sure that our touchpad uses the good old PS/2 protocol to communicate with our laptop.\nDigging more into this, touchpads actually support 3 protocols to communicate with any system, these can be\nPS/2 I2C/SMBUS (RMI3/4) USB (HID) Most old models use the PS/2 interface, and the modern ones use I2C / USB to communicate with the system.\nSynaptics actually uses the RMI3/RMI4 interface over I2C on newer touchpads.\nNow it’s time to look at this from the hardware side.\nSo this is our touchpad, from the HP Pavillion AU116-TX laptop.\nFrom the back side, we can see a single button at the bottom middle, the main synaptics IC (T1321B) in the middle, an FFC connector and the supporting FFC, and some enamel wires that I have soldered to some test pads.\nLooking on the internet for the Synaptics T13221B chip, I could find almost nothing except for some weird Chinese sellers offering the chip.\nSo, sadly, no datasheet for it.\nProbing various test points on the touchpad PCB with my trusted Rigol DS1054Z, I mapped the VCC,GND, DATA, and CLK for the PS/2 interface.\nTestpad - FFC pin - SIGNAL\nT23 - pin 4 - GND T20 - pin 1 - 3V3 T12 - pin 2 - DATA T11 - pin 3 - CLK T10 - pin 5 - 3V3 T9 - pin 6 - 3V3 One way to know what any piece of hardware is doing is to sniff its communication, The RIGOL is an awesome scope and has in-built protocol decoders for lots of protocols, but unfortunately, PS/2 isn’t one of them.\nSo I had to do this the old way…\nUsing the DSO, I captured the data transmission between the touchpad and the laptop, and I got three different segments of data transfer, I exported the capture to a CSV file to further analyse the communication on my PC.\nUsing MATLAB, we can plot Channel 1 and Channel 2 of the captured data to decode whats happening.\nYou can see three different sections of communication that are happening.\nZooming in on individual sections, we can decode the packets.\nI decoded parts of it, and here is what is happening..\n** Possible Probe by BIOS ** 0xF2 -\u003e Read Device Type 0xFA \u003c- ACK 0x00 \u003c- Response ** DELAY ** ** LARGE PACKETS (1) ** 0xF2 -\u003e Read Device Type 0xFA \u003c- ACK 0x00 \u003c- Response 0xF6 -\u003e Set Defaults 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x0A -\u003e DATA 0xFA \u003c- ACK 0xE8 -\u003e Set Resolution 0xFA \u003c- ACK 0x00 -\u003e DATA 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x14 -\u003e DATA 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x3C -\u003e DATA 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x28 -\u003e DATA 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x14 -\u003e DATA 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x14 -\u003e DATA 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x3C -\u003e DATA 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x28 -\u003e DATA 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x14 -\u003e DATA 0xFA \u003c- ACK 0xF3 -\u003e Set Sample Rate 0xFA \u003c- ACK 0x14 -\u003e DATA 0xFA \u003c- ACK 0xF2 -\u003e Read Device Type 0xFA \u003c- ACK 0x00 \u003c- Response 0xE8 -\u003e Set Resolution 0xFA \u003c- ACK 0x00 -\u003e DATA 0xFA -\u003e ACK 0xE8 -\u003e Set Resolution 0xFA \u003c- ACK 0x00 -\u003e DATA 0xFA -\u003e ACK 0xE8 -\u003e Set Resolution 0xFA \u003c- ACK 0x00 -\u003e DATA 0xFA -\u003e ACK 0xE8 -\u003e Set Resolution 0xFA \u003c- ACK 0x00 -\u003e DATA 0xFA -\u003e ACK 0xE9 -\u003e Status Request (ACK + 3 BYTE DATA) 0xFA \u003c- ACK 0x01 \u003c- DATA 0x47 \u003c- DATA 0x18 \u003c- DATA 0xFF -\u003e Reset 0xFA \u003c- ACK ** DELAY ** ** LARGE PACKETS (2) ** Further communication done by the Linux kernel module is here, almost the same as above. Synaptics has a PS/2 touchpad interfacing guide that provides excellent documentation regarding the PS/2 protocol and how to interface. with their touchpads over these protocols, the decoding of packets was based on that documentation.\nSo basically, once we power up the touchpad, it does a Power On Self Test and recalibrates itself, after that, it sends a completion code of 0xAA00.\nAfter that, we can begin sending commands to the touchpad.\nWe need to do a few things to set up the touchpad,\nDisable the touchpad reporting. Set the touchpad mode byte via the special mode byte set sequence. Set resolution Set sample rate. Enable stream mode Enable touchpad reporting. The touchpad has two modes, absolute mode and relative mode.\nRelative mode is the one you might be familiar with because that’s what is usually used by mouse(mice?) to communicate relative movement.\nAbsolute mode gives you the absolute position of finger on the touchpad.\nSo now that we know what pins do what, and how the PC initialises the touchpad, we need a way to communicate with the touchpad ourselves, Here comes the RPI-Pico to the rescue.\nI hooked the touchpad to a Raspberry Pi Pico and wrote a PS/2 bit-banging library to send and receive packets.\nI initialised the touchpad based on the above mentioned method with the mode byte set to absolute mode and data streaming enabled, which means the touchpad would automatically send me packets once a touch has been registered, and there we have it.\nPlotting absolute X and Y coordinates\nIn one of the coming blog posts, I will use machine learning on a microcontroller for gesture detection using this touchpad.\nStay tuned for that!\n","wordCount":"1473","inLanguage":"en","datePublished":"2022-12-19T01:09:32+05:30","dateModified":"2022-12-19T01:09:32+05:30","author":{"@type":"Person","name":"magalsh64"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://qcentlabs.com/posts/synaptics_hack/"},"publisher":{"@type":"Organization","name":"qcentlabs","logo":{"@type":"ImageObject","url":"http://qcentlabs.com/logo.png"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=http://qcentlabs.com/ accesskey=h title="qcentlabs (Alt + H)">qcentlabs</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=http://qcentlabs.com/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://qcentlabs.com/>Home</a>&nbsp;»&nbsp;<a href=http://qcentlabs.com/posts/>Posts</a></div><h1 class=post-title>Hacking a Synaptics touchpad.</h1><div class=post-meta><span title='2022-12-19 01:09:32 +0530 IST'>December 19, 2022</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;magalsh64</div></header><div class=post-content><h2 id=the-backstory>The Backstory:<a hidden class=anchor aria-hidden=true href=#the-backstory>#</a></h2><p>I&rsquo;ve had a few laptops over the years, and one of the first things I do whenever I&rsquo;ve got a new piece of hardware is open it up.</p><p>Well, I live in India, and the environment here is quite dusty, so this act of opening and cleaning happens quite often.</p><p>Unfortunately, if you own a laptop with a plastic body, this becomes quite an issue, as plastic body laptops have
knurled nuts pushed into the body, the plastic housings of these nuts tend to break over time if you regularly screw and unscrew.
them.</p><p>This is especially a problem with the screws holding the LCD hinge to the main body, as these tend to break first, I&rsquo;ve had at least 2
laptops that have broken this way.</p><p>So, coming back to the main title of this post, I had an old HP laptop lying around that had a broken hinge nut collecting dust, so I thought,
Why not make something useful out of it?</p><p><img loading=lazy src=/images/broken_laptop.gif alt=BROKEN_LAPTOP></p><p>^^ My actual HP laptop :D ^^</p><p>So the plan was to use the motherboard as an external PC, encased in a acrylic case with all the RGB shenanigans.
What was left were the keyboard, touchpad, and display.</p><p>The keyboard was the part of the main body that broke with the hinge, so that&rsquo;s a goner.</p><p>The displays eDP cable pads rusted and broke after being exposed to the bare environment for years.</p><p>But somehow, the touchpad was fine and dandy.</p><h2 id=the-saviour-of-touchpads>The Saviour of Touchpads<a hidden class=anchor aria-hidden=true href=#the-saviour-of-touchpads>#</a></h2><p>So, the time came to reverse engineer the touchpad and hopefully use it in some other useful projects in the future.</p><p>There are many ways to approach the problem of reverse engineering hardware.</p><p>In our case, we have complete access to the system that we are trying to reverse engineer, which makes our job easy.</p><p>We can observe the system from 2 sides:</p><ul><li>The Software</li><li>The Hardware</li></ul><p>From the software side, the laptops run Linux, which in itself helps us a lot, We can look into the kernel logs to see
how it enumerates all the hardware.</p><p>Let&rsquo;s look into the kernel logs via dmesg and see if something comes up related to our touchpad.</p><p><img loading=lazy src=/images/synaptics_dmesg.jpg alt=DMESG_LOG></p><p>Voila! We can see the psmouse kernel module enumerating a synaptics touchpad, and we can also see the module logs list the max and min.
values that the touchpad can output, and a string of possible touchpad IDs that match the one we have.</p><p>The beauty of Linux is that <strong>almost</strong> all of it is open source, including the device drivers, which are a huge chunk of the kernel source.</p><p>So we can just look into the source of the corresponding kernel module that enumerated our hardware to see how it works.</p><p>[synaptics.c] (<a href=https://github.com/torvalds/linux/blob/master/drivers/input/mouse/synaptics.c>https://github.com/torvalds/linux/blob/master/drivers/input/mouse/synaptics.c</a>)</p><p>Looking at the sources, we can see how the module handles the device initialization, queries the hardware, identifies the capabilities of the device,
setting its mode and then receiving packets and sending them forward into the input subsystem.</p><p>We also get to see that the module uses the psmouse module sources to actually send and receive packets, so we now know for sure that our touchpad uses
the good old PS/2 protocol to communicate with our laptop.</p><p>Digging more into this, touchpads actually support 3 protocols to communicate with any system, these can be</p><ul><li>PS/2</li><li>I2C/SMBUS (RMI3/4)</li><li>USB (HID)</li></ul><p>Most old models use the PS/2 interface, and the modern ones use I2C / USB to communicate with the system.</p><p>Synaptics actually uses the RMI3/RMI4 interface over I2C on newer touchpads.</p><p>Now it&rsquo;s time to look at this from the hardware side.</p><p><img loading=lazy src=/images/synaptics_back.jpg alt=TOUCHPAD_BACK></p><p>So this is our touchpad, from the HP Pavillion AU116-TX laptop.</p><p>From the back side, we can see a single button at the bottom middle, the main synaptics IC (T1321B) in the middle, an FFC connector and the supporting FFC, and some enamel wires that I have soldered to some test pads.</p><p>Looking on the internet for the Synaptics T13221B chip, I could find almost nothing except for some weird Chinese sellers offering the chip.</p><p>So, sadly, no datasheet for it.</p><p><img loading=lazy src=/images/synaptics_rigol.jpg alt=TOUCHPAD_PROBE></p><p>Probing various test points on the touchpad PCB with my trusted Rigol DS1054Z, I mapped the VCC,GND, DATA, and CLK for the PS/2 interface.</p><p>Testpad - FFC pin - SIGNAL</p><ul><li>T23 - pin 4 - GND</li><li>T20 - pin 1 - 3V3</li><li>T12 - pin 2 - DATA</li><li>T11 - pin 3 - CLK</li><li>T10 - pin 5 - 3V3</li><li>T9 - pin 6 - 3V3</li></ul><p>One way to know what any piece of hardware is doing is to sniff its communication, The RIGOL is an awesome scope and has
in-built protocol decoders for lots of protocols, but unfortunately, PS/2 isn&rsquo;t one of them.</p><p>So I had to do this the old way&mldr;</p><p>Using the DSO, I captured the data transmission between the touchpad and the laptop, and I got three different segments of data transfer,
I exported the capture to a CSV file to further analyse the communication on my PC.</p><p>Using MATLAB, we can plot Channel 1 and Channel 2 of the captured data to decode whats happening.</p><p><img loading=lazy src=/images/synaptics_matlab1.png alt=TOUCHPAD_MATLAB1></p><p>You can see three different sections of communication that are happening.</p><p>Zooming in on individual sections, we can decode the packets.</p><p><img loading=lazy src=/images/synaptics_matlab2.jpg alt=TOUCHPAD_MATLAB2></p><p>I decoded parts of it, and here is what is happening..</p><pre tabindex=0><code>

** Possible Probe by BIOS **


0xF2 -&gt; Read Device Type
0xFA &lt;- ACK
0x00 &lt;- Response



** DELAY **


** LARGE PACKETS (1) **


0xF2 -&gt; Read Device Type
0xFA &lt;- ACK
0x00 &lt;- Response


0xF6 -&gt; Set Defaults
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x0A -&gt; DATA
0xFA &lt;- ACK


0xE8 -&gt; Set Resolution
0xFA &lt;- ACK


0x00 -&gt; DATA
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x14 -&gt; DATA
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x3C -&gt; DATA
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x28 -&gt; DATA
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x14 -&gt; DATA
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x14 -&gt; DATA
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x3C -&gt; DATA
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x28 -&gt; DATA
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x14 -&gt; DATA
0xFA &lt;- ACK


0xF3 -&gt; Set Sample Rate
0xFA &lt;- ACK


0x14 -&gt; DATA
0xFA &lt;- ACK


0xF2 -&gt; Read Device Type
0xFA &lt;- ACK
0x00 &lt;- Response


0xE8 -&gt; Set Resolution
0xFA &lt;- ACK


0x00 -&gt; DATA
0xFA -&gt; ACK


0xE8 -&gt; Set Resolution
0xFA &lt;- ACK


0x00 -&gt; DATA
0xFA -&gt; ACK


0xE8 -&gt; Set Resolution
0xFA &lt;- ACK


0x00 -&gt; DATA
0xFA -&gt; ACK


0xE8 -&gt; Set Resolution
0xFA &lt;- ACK


0x00 -&gt; DATA
0xFA -&gt; ACK


0xE9 -&gt; Status Request (ACK + 3 BYTE DATA)
0xFA &lt;- ACK
0x01 &lt;- DATA
0x47 &lt;- DATA
0x18 &lt;- DATA


0xFF -&gt; Reset
0xFA &lt;- ACK



** DELAY **


** LARGE PACKETS (2) **


Further communication done by the Linux kernel module is here, almost the same as above.
</code></pre><p>Synaptics has a PS/2 touchpad interfacing guide that provides excellent documentation regarding the PS/2 protocol and how to interface.
with their touchpads over these protocols, the decoding of packets was based on that documentation.</p><p>So basically, once we power up the touchpad, it does a Power On Self Test and recalibrates itself, after that, it sends a completion code of 0xAA00.</p><p>After that, we can begin sending commands to the touchpad.</p><p>We need to do a few things to set up the touchpad,</p><ul><li>Disable the touchpad reporting.</li><li>Set the touchpad mode byte via the special mode byte set sequence.</li><li>Set resolution</li><li>Set sample rate.</li><li>Enable stream mode</li><li>Enable touchpad reporting.</li></ul><p>The touchpad has two modes, absolute mode and relative mode.</p><p>Relative mode is the one you might be familiar with because that&rsquo;s what is usually used by mouse(mice?) to communicate relative movement.</p><p>Absolute mode gives you the absolute position of finger on the touchpad.</p><p>So now that we know what pins do what, and how the PC initialises the touchpad, we need a way to communicate with the touchpad ourselves, Here comes the RPI-Pico to the rescue.</p><p><img loading=lazy src=/images/synaptics_pico.jpg alt=TOUCHPAD_PICO></p><p>I hooked the touchpad to a Raspberry Pi Pico and wrote a PS/2 bit-banging library to send and receive packets.</p><p>I initialised the touchpad based on the above mentioned method with the mode byte set to absolute mode and data streaming enabled, which means the touchpad would
automatically send me packets once a touch has been registered, and there we have it.</p><p><img loading=lazy src=/images/touchpad.gif alt=TOUCHPAD_PICO></p><p>Plotting absolute X and Y coordinates</p><p>In one of the coming blog posts, I will use machine learning on a microcontroller for gesture detection using this touchpad.</p><p>Stay tuned for that!</p></div><footer class=post-footer><nav class=paginav><a class=prev href=http://qcentlabs.com/posts/fast_gpio/><span class=title>« Prev Page</span><br><span>IMXRT, The Fastest GPIO Toggler in Town.</span></a>
<a class=next href=http://qcentlabs.com/posts/mimxrt1010/><span class=title>Next Page »</span><br><span>Making an Arduino Killer.</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Hacking a Synaptics touchpad. on twitter" href="https://twitter.com/intent/tweet/?text=Hacking%20a%20Synaptics%20touchpad.&amp;url=http%3a%2f%2fqcentlabs.com%2fposts%2fsynaptics_hack%2f&amp;hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacking a Synaptics touchpad. on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fqcentlabs.com%2fposts%2fsynaptics_hack%2f&amp;title=Hacking%20a%20Synaptics%20touchpad.&amp;summary=Hacking%20a%20Synaptics%20touchpad.&amp;source=http%3a%2f%2fqcentlabs.com%2fposts%2fsynaptics_hack%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacking a Synaptics touchpad. on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fqcentlabs.com%2fposts%2fsynaptics_hack%2f&title=Hacking%20a%20Synaptics%20touchpad."><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacking a Synaptics touchpad. on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fqcentlabs.com%2fposts%2fsynaptics_hack%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacking a Synaptics touchpad. on whatsapp" href="https://api.whatsapp.com/send?text=Hacking%20a%20Synaptics%20touchpad.%20-%20http%3a%2f%2fqcentlabs.com%2fposts%2fsynaptics_hack%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacking a Synaptics touchpad. on telegram" href="https://telegram.me/share/url?text=Hacking%20a%20Synaptics%20touchpad.&amp;url=http%3a%2f%2fqcentlabs.com%2fposts%2fsynaptics_hack%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=http://qcentlabs.com/>qcentlabs</a></span>
<span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>